{% extends "layout.html" %}
{% load static %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'css/battle.css' %}">
{% endblock %}

{% block content %}
<div class="battle-container">
    <div class="arena">
        <!-- Challenger Card -->
        <div class="combatant-card">
            <h2>{{ challenger.username }} {% if challenger.id == player_id %}(You){% endif %}</h2>
            <div class="hp-bar-container">
                <div class="hp-bar" style="width: {% widthratio challenger_hp challenger.max_hp 100 %}%"></div>
            </div>
            <p>HP: {{ challenger_hp }} / {{ challenger.max_hp }}</p>
        </div>

        <!-- Opponent Card -->
        <div class="combatant-card">
            <h2>{{ opponent.username }} {% if opponent.id == player_id %}(You){% endif %}</h2>
            <div class="hp-bar-container">
                <div class="hp-bar" style="width: {% widthratio opponent_hp opponent.max_hp 100 %}%"></div>
            </div>
            <p>HP: {{ opponent_hp }} / {{ opponent.max_hp }}</p>
        </div>
    </div>

    <!-- Actions Panel -->
    <div class="actions">
        {% if is_my_turn %}
            <h3>Your Turn! Choose a Spell:</h3>
            <form method="post" action="{% url 'battle' battle_id %}">
                {% csrf_token %}
                {% for spell in player_spells %}
                    <button type="submit" name="spell_id" value="{{ spell.0 }}" class="btn-spell">
                        {{ spell.1 }} ({{ spell.2 }} Damage)
                    </button>
                {% empty %}
                    <p>You don't know any spells! You can't attack.</p>
                {% endfor %}
            </form>
        {% else %}
            <h3>Waiting for opponent's move...</h3>
            <p>(Refresh the page to see their move)</p>
        {% endif %}
    </div>
</div>
{% endblock %}